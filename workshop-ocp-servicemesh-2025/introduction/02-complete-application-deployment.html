<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Lab 2 - Complete application deployment :: WorkShop - Service Mesh on OCP 2025</title>
    <link rel="canonical" href="https://nveces.github.io/workshop-ocp-servicemesh-2025/workshop-ocp-servicemesh-2025/introduction/02-complete-application-deployment.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../../_/css/site.css">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img
          src="../../_/img/header_logo.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" href="https://nveces.github.io/workshop-ocp-servicemesh-2025">WorkShop - Service Mesh on OCP 2025</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Books</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">CheatSheets</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">CheatSheet A</a>
            <a class="navbar-item" href="#">CheatSheet B</a>
            <a class="navbar-item" href="#">CheatSheet C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Upcoming Events</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Event A</a>
            <a class="navbar-item" href="#">Event B</a>
            <a class="navbar-item" href="#">Event C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Tutorial A</a>
            <a class="navbar-item" href="#">Tutorial B</a>
            <a class="navbar-item" href="#">Tutorial C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="workshop-ocp-servicemesh-2025" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">WorkShop - Service Mesh on OCP 2025</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../01-setup.html">1. Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../01-setup.html#prerequisite">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../01-setup.html#minikube">Setup Minikube</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../02-deploy.html">2. Deploy Service</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../02-deploy.html#package">Build Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../02-deploy.html#deploy">Deploy Dervice</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">WorkShop - Service Mesh on OCP 2025</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">WorkShop - Service Mesh on OCP 2025</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="../index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">WorkShop - Service Mesh on OCP 2025</a></li>
    <li><a href="02-complete-application-deployment.html">Lab 2 - Complete application deployment</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/nveces/workshop-ocp-servicemesh-2025/edit/master/documentation/modules/ROOT/pages/introduction/02-complete-application-deployment.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Lab 2 - Complete application deployment</h1>
<div id="toc" class="toc">
<div id="toctitle">Complete application deployment</div>
<ul class="sectlevel1">
<li><a href="#_deploy_and_ephemeral_postgresql">1. Deploy and ephemeral Postgresql</a></li>
<li><a href="#_connect_application_to_database">2. Connect application to Database</a></li>
<li><a href="#_scale_the_application_pod_replicas">3. Scale the application pod replicas</a>
<ul class="sectlevel2">
<li><a href="#_extra_rolling_vs_recreate_deployment_strategy">3.1. Extra: Rolling vs Recreate deployment strategy</a></li>
</ul>
</li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In previous lab, we have just deployed a single application without considering its requirements. We just wanted to have it running and play a bit with Openshift.</p>
</div>
<div class="paragraph">
<p>In this lab, we will deploy a Postgresql Database and we will update the application deployment image to ensure we don&#8217;t use an in-memory DB so we will link the application to the Postgresql DB instead.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_deploy_and_ephemeral_postgresql"><a class="anchor" href="#_deploy_and_ephemeral_postgresql"></a>1. Deploy and ephemeral Postgresql</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This time, we will do the full deployment from the <code>web console</code>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s move to the <code>console</code> and select the <code>Developer</code> view.</p>
</div>
<div class="paragraph">
<p>As in next screenshot, first, ensure you are on the right project (it is very likely you are.. unless you have created more than one project), click on <code>Add</code> and select <code>Database</code>:</p>
</div>
<div class="paragraph">
<p><span class="image unresolved"><img src="dev-add-db.png" alt="add db"></span></p>
</div>
<div class="paragraph">
<p>Then, select <code>Postgresql ephemeral</code>:</p>
</div>
<div class="paragraph">
<p><span class="image unresolved"><img src="select-postgresql-eph.png" alt="postgresql ephemeral"></span></p>
</div>
<div class="paragraph">
<p>Yes.. we are going to deploy an ephemeral Postgresql&#8230;&#8203; so in case the Postgresql <code>pod</code> is recreated we will lose the data. We will add a persistent volume later in these labs.</p>
</div>
<div class="paragraph">
<p>Click on <code>Instantiate Template</code>:</p>
</div>
<div class="paragraph">
<p><span class="image unresolved"><img src="instantiate-template.png" alt="instantiate template"></span></p>
</div>
<div class="paragraph">
<p>And set the following parameter values set in red (ensure you use those):</p>
</div>
<div class="paragraph">
<p><span class="image unresolved"><img src="db-parameters.png" alt="db parameters"></span></p>
</div>
<div class="paragraph">
<p>As a result, you should see both the application and postgresql pods running:</p>
</div>
<div class="paragraph">
<p><span class="image unresolved"><img src="apps-pods.png" alt="application pods"></span></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_connect_application_to_database"><a class="anchor" href="#_connect_application_to_database"></a>2. Connect application to Database</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We have now the Postgresql pod running, but the application pod is not connected to it yet.</p>
</div>
<div class="paragraph">
<p>For that, we will deploy a new application image tag that has the proper configuration to connect to the DB (the application configuration is set in this <a href="https://github.com/dsanchor/petclinic/blob/mnl-db/quarkus-petclinic/src/main/resources/application.properties">application.properties</a> file).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This approach of defining the configuration within the application (and then, inside the image) could be seen as not very Cloud Native&#8230;&#8203; even when it is somehow set with profiles. To solve this, we will extract this configuration to a <code>ConfigMap</code> later on these labs.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is time for deploy a new version of our application. To do so, we will only update the image in our existing deployment:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ oc set image deployment/quarkus-petclinic *=quay.io/dsanchor/quarkus-petclinic:db  -n &lt;YOUR_PROJECT&gt;

deployment.apps/quarkus-petclinic image updated</pre>
</div>
</div>
<div class="paragraph">
<p>Once the image has been updated, a new pod has been created, while the old one has been terminated. If you missed that process, here it is a short replay:</p>
</div>
<div class="paragraph">
<p><span class="image unresolved"><img src="rolling-update.gif" alt="rolling update"></span></p>
</div>
<div class="paragraph">
<p>That list of <code>pods</code> could be seen under the <code>Administrator</code> view, then <code>Workloads</code> and finally <code>Pods</code>.</p>
</div>
<div class="paragraph">
<p>We can now test the application again. Feel free to add new owners, pets and so on, those new changes are now persisted in the Database. To validate this behavior, delete the existing application <code>pod</code> and validate that the data is still there when the new <code>pod</code> has been created.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_scale_the_application_pod_replicas"><a class="anchor" href="#_scale_the_application_pod_replicas"></a>3. Scale the application pod replicas</h2>
<div class="sectionbody">
<div class="paragraph">
<p>So far, we have just a single replica of our "Pet clinic" web site&#8230;&#8203; That is not high available and fault tolerant at all.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s scale it up to 3 replicas by running the next command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>oc scale deployment/quarkus-petclinic --replicas=3 -n &lt;YOUR_PROJECT&gt;

deployment.apps/quarkus-petclinic scaled</pre>
</div>
</div>
<div class="paragraph">
<p>You could now continue adding data from the web application, it does not matter from which <code>pod</code> you are accesing to the Database, the same data is accessible from all the application pods.</p>
</div>
<div class="paragraph">
<p>Feel free to scale it down and up again and check that the application works as expected and does not miss any data.</p>
</div>
<div class="sect2">
<h3 id="_extra_rolling_vs_recreate_deployment_strategy"><a class="anchor" href="#_extra_rolling_vs_recreate_deployment_strategy"></a>3.1. Extra: Rolling vs Recreate deployment strategy</h3>
<div class="paragraph">
<p>Have a look at the following resources and then, answer a couple of questions that are related to this topic based on our scenario:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.openshift.com/container-platform/4.6/applications/deployments/deployment-strategies.html#deployments-rolling-strategy_deployment-strategies">Rolling</a></p>
</li>
<li>
<p><a href="https://docs.openshift.com/container-platform/4.6/applications/deployments/deployment-strategies.html#deployments-recreate-strategy_deployment-strategies">Recreate</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So.. could you have a look at what strategies are used in both the application and the Database? Why are they different?</p>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../../_/js/vendor/clipboard.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
