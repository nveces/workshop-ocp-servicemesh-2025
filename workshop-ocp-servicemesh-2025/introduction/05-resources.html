<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Lab 5 - Resources :: WorkShop - Service Mesh on OCP 2025</title>
    <link rel="canonical" href="https://nveces.github.io/workshop-ocp-servicemesh-2025/workshop-ocp-servicemesh-2025/introduction/05-resources.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../../_/css/site.css">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img
          src="../../_/img/header_logo.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" href="https://nveces.github.io/workshop-ocp-servicemesh-2025">WorkShop - Service Mesh on OCP 2025</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Books</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">CheatSheets</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">CheatSheet A</a>
            <a class="navbar-item" href="#">CheatSheet B</a>
            <a class="navbar-item" href="#">CheatSheet C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Upcoming Events</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Event A</a>
            <a class="navbar-item" href="#">Event B</a>
            <a class="navbar-item" href="#">Event C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Tutorial A</a>
            <a class="navbar-item" href="#">Tutorial B</a>
            <a class="navbar-item" href="#">Tutorial C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="workshop-ocp-servicemesh-2025" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">WorkShop - Service Mesh on OCP 2025</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../01-setup.html">1. Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../01-setup.html#prerequisite">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../01-setup.html#minikube">Setup Minikube</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../02-deploy.html">2. Deploy Service</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../02-deploy.html#package">Build Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../02-deploy.html#deploy">Deploy Dervice</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">3. Introduction - Labs</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_lab_0_warming_up">Lab 0 - Warming up</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_lab_1_first_application_deployment">Lab 1 - First application deployment</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">WorkShop - Service Mesh on OCP 2025</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">WorkShop - Service Mesh on OCP 2025</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="../index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">WorkShop - Service Mesh on OCP 2025</a></li>
    <li><a href="05-resources.html">Lab 5 - Resources</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/nveces/workshop-ocp-servicemesh-2025/edit/master/documentation/modules/ROOT/pages/introduction/05-resources.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Lab 5 - Resources</h1>
<div id="toc" class="toc">
<div id="toctitle">Resources</div>
<ul class="sectlevel1">
<li><a href="#_requests_and_limits">1. Requests and limits</a></li>
<li><a href="#_quality_of_service">2. Quality of Service</a></li>
<li><a href="#_configure_resources">3. Configure resources</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In next lab, we will introduce how to define resources in <code>pods</code> (memory and cpu), so that, the Kubernetes scheduler will use this information to place <code>pods</code> in the right nodes and also, to decide which <code>pods</code> are more likely to be evicted first based on its QoS (Quality of Service)</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_requests_and_limits"><a class="anchor" href="#_requests_and_limits"></a>1. Requests and limits</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Next paragraphs have been extracted from the official <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#requests-and-limits">Kubernetes documentation</a>. Summary is next.</p>
</div>
<div class="paragraph">
<p>When you specify the resource request for Containers in a Pod, the scheduler uses this information to decide which node to place the Pod on. When you specify a resource limit for a Container, the kubelet enforces those limits so that the running container is not allowed to use more of that resource than the limit you set. The kubelet also reserves at least the request amount of that system resource specifically for that container to use.</p>
</div>
<div class="paragraph">
<p>If the node where a Pod is running has enough of a resource available, it&#8217;s possible (and allowed) for a container to use more resource than its request for that resource specifies. However, a container is not allowed to use more than its resource limit.</p>
</div>
<div class="paragraph">
<p>For example, if you set a memory request of 256 MiB for a container, and that container is in a Pod scheduled to a Node with 8GiB of memory and no other Pods, then the container can try to use more RAM.</p>
</div>
<div class="paragraph">
<p>If you set a memory limit of 4GiB for that Container, the kubelet (and container runtime) enforce the limit. The runtime prevents the container from using more than the configured resource limit. For example: when a process in the container tries to consume more than the allowed amount of memory, the system kernel terminates the process that attempted the allocation, with an out of memory (OOM) error.</p>
</div>
<div class="paragraph">
<p>Limits can be implemented either reactively (the system intervenes once it sees a violation) or by enforcement (the system prevents the container from ever exceeding the limit). Different runtimes can have different ways to implement the same restrictions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_quality_of_service"><a class="anchor" href="#_quality_of_service"></a>2. Quality of Service</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Kubernetes provides different levels of Quality of Service to pods depending on what values for <code>request</code> and <code>limits</code> are set for them.</p>
</div>
<div class="paragraph">
<p>For each resource, containers specify a <code>request</code>, which is the amount of that resource that the system will guarantee to the container, and a <code>limit</code> which is the maximum amount that the system will allow the container to use.</p>
</div>
<div class="paragraph">
<p>Based on what values are in each case, we have the following <code>QoS</code>:</p>
</div>
<div class="paragraph">
<p><span class="image unresolved"><img src="cncf-qos.png" alt="QoS"></span></p>
</div>
<div class="paragraph">
<p>As the table shows (source CNCF), the QoS class of a pod does affect the order in which it is chosen for eviction by the Kubelet.</p>
</div>
<div class="paragraph">
<p>Kubelet first evicts BestEffort and Burstable pods using resources above requests. The order of eviction depends on the priority assigned to each pod and the amount of resources being consumed above request.</p>
</div>
<div class="paragraph">
<p>Guaranteed and Burstable pods not exceeding resource requests are evicted next based on which ones have the lowest priority.</p>
</div>
<div class="paragraph">
<p>Both Guaranteed and Burstable pods whose resource usage is lower than the requested amount are never evicted because of the resource usage of another pod. They might, however, be evicted if system daemons start using more resources than reserved. In this case, Guaranteed and Burstable pods with the lowest priority are evicted first.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configure_resources"><a class="anchor" href="#_configure_resources"></a>3. Configure resources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once we have understood the value of the different <code>QoS</code> and how resources could be configured, we will set two different kinds of 'QoS' as an example.</p>
</div>
<div class="paragraph">
<p>For the Postgresql Database, we will set <code>Guaranteed</code> resources, while we leave the application as <code>Burstable</code>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s start with the DB. We will use the <code>oc</code> cli in both cases. We will set 512m and 10 milicores:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ oc set resources dc/petclinic-database --limits=cpu=10m,memory=512Mi --requests=cpu=10m,memory=512Mi -n &lt;TOUR PROJECT&gt;

deploymentconfig.apps.openshift.io/petclinic-database resource requirements updated</pre>
</div>
</div>
<div class="paragraph">
<p>And then, we will just define cpu and memory <code>request</code> in our application, so we let the application consume as much as the node can give to <code>pods</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ oc set resources deployment/quarkus-petclinic --requests=cpu=10m,memory=256Mi -n &lt;TOUR PROJECT&gt;

deployment.apps/quarkus-petclinic resource requirements updated</pre>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../../_/js/vendor/clipboard.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
