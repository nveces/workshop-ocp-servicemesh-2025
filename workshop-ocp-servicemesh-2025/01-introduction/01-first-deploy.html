<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Lab 1 - First application deployment :: WorkShop - Service Mesh on OCP 2025</title>
    <link rel="canonical" href="https://nveces.github.io/workshop-ocp-servicemesh-2025/workshop-ocp-servicemesh-2025/01-introduction/01-first-deploy.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../../_/css/site.css">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="../../_/img/RHDLogo.svg" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://nveces.github.io/workshop-ocp-servicemesh-2025">WorkShop - Service Mesh on OCP 2025</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kafka-tutorial/" target="_blank">Kafka</a>
            <a class="navbar-item" href="https://devsecops-workshop.github.io/" target="_blank">DevSecOps</a>
            <a class="navbar-item" href="https://acidonper.github.io/redhat-workshop-cicd-gitops/redhat-workshop-cicd-gitops/" target="_blank">CI/CD & GitOps</a>
            <a class="navbar-item" href="https://atarazana.github.io/gramola-gitops-guide/gramola-gitops-guide/" target="_blank">Gramola GitOps Guide</a>
            <a class="navbar-item" href="https://luisarizmendi.github.io/tutorial-secure-onboarding/" target="_blank">Secure Edge device onboarding with RHEL and FDO</a>
            <a class="navbar-item" href="https://xbryan1.github.io/rhte-2023-acm-docs/" target="_blank">Multicluster Application Deployment with Advanced Cluster Management and GitOps</a>
            <a class="navbar-item" href="https://redhat-scholars.github.io/java-inner-loop-dev-guide/java-inner-loop-dev-guide/index.html" target="_blank">Java Inner Loop Dev Guide</a>
            <a class="navbar-item" href="https://atarazana.github.io/kitchensink-guide/" target="_blank">Deploying JBoss EAP applications on OpenShift</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="workshop-ocp-servicemesh-2025" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../01-setup.html">1. Environment Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../01-setup.html#prerequisite">Prerequisites</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">2. Introduction - Labs</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_lab_0_warming_up">Lab 0 - Warming up</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_lab_1_database_deployment">Lab 1 - Database deployment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_lab_1_first_application_deployment">Lab 2 - First application deployment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_lab_2_complete_application_deployment">Lab 3 - Complete application deployment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_lab_3_adding_persistent_volumes">Lab 4 - Adding persistent volumes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_lab_4_configuration_management">Lab 5 - Configuration management</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_lab_5_resources">Lab 6 - Resources</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_lab_6_liveness_and_readiness_probes">Lab 7 - Liveness and readiness probes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../02-envoy-istio-control-plane/index.html">3. Envoy istio Control plane - Labs</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../02-envoy-istio-control-plane/index.html#_lab_1_setup">Lab 1 - Setup</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../02-envoy-istio-control-plane/index.html#_lab_2_deploy_jump_app">Lab 2 - Deploy Jump App</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../02-envoy-istio-control-plane/index.html#_lab_3_service_mesh_communication_flows">Lab 3 - Service Mesh Communication Flows</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../02-envoy-istio-control-plane/index.html#_lab_4_istio_envoy_objects_relationship">Lab 4 - Istio-Envoy Objects Relationship</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../02-envoy-istio-control-plane/index.html#_lab_5_envoy_proxy">Lab 5 - Envoy Proxy</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../02-envoy-istio-control-plane/index.html#_lab_6_istio_control_plane">Lab 6 - Istio Control Plane</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../02-envoy-istio-control-plane/index.html#_lab_7_istio_global_services">Lab 7 - Istio Global Services</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../03-traffic-management/index.html">4. Traffic management - Labs</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../03-traffic-management/index.html#_rhossm_traffic_management_labs">Red Hat OpenShift Service Mesh: Traffic Management Labs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../03-traffic-management/index.html#_lab_1_ingress_gateways">Lab 1 - Ingress Gateways</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../03-traffic-management/index.html#_lab_2_requests_routing">Lab 2 - Requests Routing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../03-traffic-management/index.html#_lab_3_traffic_shifting_and_weight_balancing">Lab 3 - Traffic Shifting and Weight Balancing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../03-traffic-management/index.html#_lab_4_fault_injection">Lab 4 - Fault Injection</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../03-traffic-management/index.html#_lab_5_requests_timeouts">Lab 5 - Requests Timeouts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../03-traffic-management/index.html#_lab_6_circuit_breaking">Lab 6 - Circuit Breaking</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../03-traffic-management/index.html#_lab_7_mirroring_and_dark_launches">Lab 7 - Mirroring and Dark Launches</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../03-traffic-management/index.html#_lab_0_warming_up">Lab 0 - Warming up</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../04-troubleshooting/index.html">5. Troubleshooting - Labs</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../04-troubleshooting/index.html#_lab_1_setup">Lab 1 - Setup</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../04-troubleshooting/index.html#_lab_2_deploy_jump_app">Lab 2 - Deploy Jump App</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../04-troubleshooting/index.html#_lab_3_service_mesh_communication_flows">Lab 3 - Service Mesh Communication Flows</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../04-troubleshooting/index.html#_lab_4_service_mesh_ingress_traffic_flow">Lab 4 - Service Mesh Ingress Traffic Flow</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../04-troubleshooting/index.html#_lab_5_service_mesh_secure_ingress_traffic_flow">Lab 5 - Service Mesh Secure Ingress Traffic Flow</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../04-troubleshooting/index.html#_lab_6_service_mesh_secure_egress_traffic_flow">Lab 6 - Service Mesh Secure Egress Traffic Flow</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../04-troubleshooting/index.html#_lab_7_troubleshooting_tools">Lab 7 - Troubleshooting Tools</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../05-security/index.html">6. Security - Labs</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../05-security/index.html#_lab_0_warming_up">Lab 0 - Warming up</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../05-security/index.html#_lab_1_setup_demo_applications">Lab 1 - Setup demo applications</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../05-security/index.html#_lab_2_peerauthentication">Lab 2 - PeerAuthentication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../05-security/index.html#_lab_3_authorization_part_1">Lab 3 - Authorization: part 1</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../05-security/index.html#_lab_4_requestauthentication">Lab 4 - RequestAuthentication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../05-security/index.html#_lab_5_authorization_part_2">Lab 5 - Authorization: part 2</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../06-extensibility/index.html">7. Extensibility - Labs</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../06-extensibility/index.html#_rhossm_extensibility_labs">Red Hat OpenShift Service Mesh: Extensibility Labs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../06-extensibility/index.html#_lab_1_envoy_filters">Lab 1 - Envoy Filters</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../06-extensibility/index.html#_lab_2_waes">Lab 2 - WebAssembly Extensions</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">WorkShop - Service Mesh on OCP 2025</a></li>
    <li><a href="01-first-deploy.html">Lab 1 - First application deployment</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/nveces/workshop-ocp-servicemesh-2025/edit/master/documentation/modules/ROOT/pages/01-introduction/01-first-deploy.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Lab 1 - First application deployment</h1>
<div id="toc" class="toc">
<div id="toctitle">First application deployment</div>
<ul class="sectlevel1">
<li><a href="#_brief_application_description">1. Brief application description</a></li>
<li><a href="#_deploy_application">2. Deploy application</a>
<ul class="sectlevel2">
<li><a href="#_create_our_first_deployment_in_your_project">2.1. Create our first deployment in your project</a></li>
<li><a href="#_add_a_service_to_your_application">2.2. Add a service to your application</a></li>
<li><a href="#_create_a_route">2.3. Create a route</a></li>
</ul>
</li>
<li><a href="#_scale_the_application_pod_replicas">3. Scale the application pod replicas</a>
<ul class="sectlevel2">
<li><a href="#_extra_rolling_vs_recreate_deployment_strategy">3.1. Extra: Rolling vs Recreate deployment strategy</a></li>
</ul>
</li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Once this lab is completed, we will have successfully deployed our first application and we will also have made it externally accesible.</p>
</div>
<div class="paragraph">
<p>The main goals of this lab is to understand some core concepts such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/" target="_blank" rel="noopener">Deployments</a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/services-networking/service/" target="_blank" rel="noopener">Services</a></p>
</li>
<li>
<p><a href="https://docs.redhat.com/en/documentation/openshift_container_platform/4.18/html/network_apis/route-route-openshift-io-v1" target="_blank" rel="noopener">Routes</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_brief_application_description"><a class="anchor" href="#_brief_application_description"></a>1. Brief application description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The application that we are going to use during these labs is called <strong>Pet clinic</strong>. It has been used in different workshops in Red Hat.</p>
</div>
<div class="paragraph">
<p>In our case, we have made some modifications to make it more appropiate to certain use cases we wanted to show during the labs.</p>
</div>
<div class="paragraph">
<p>Next diagram describes the 3 layer application architecture:</p>
</div>
<div class="paragraph">
<p><span class="image"><a class="image" href="../_images/01-introduction/app-arch.png" target="_blank" rel="noopener"><img src="../_images/01-introduction/app-arch.png" alt="app-arch"></a></span></p>
</div>
<div class="paragraph">
<p>It basically manage set of Pets, their Owners and Veterinarians appointments. We will play a bit when needed in the labs.</p>
</div>
<div class="paragraph">
<p>Source code is available <a href="https://github.com/dsanchor/petclinic.git" target="_blank" rel="noopener">here</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As these labs are not intended to be a development nor Quarkus workshop, I will not give more details about the application itself unless they are related to Openshift integration.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_deploy_application"><a class="anchor" href="#_deploy_application"></a>2. Deploy application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are many ways of performing our first deployment (web console, cli options and so on), but I want to start by creating the first deployment using the YAML descriptor.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s have a look at the full YAML file first:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: Deployment
apiVersion: apps/v1
metadata:
  name: quarkus-petclinic
  labels:
    app: quarkus-petclinic
spec:
  replicas: 1
  selector:
    matchLabels:
      app: quarkus-petclinic
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 25%
      maxSurge: 25%
  revisionHistoryLimit: 10
  progressDeadlineSeconds: 600
  template:
    metadata:
      labels:
        app: quarkus-petclinic
        deployment: quarkus-petclinic
    spec:
      containers:
        - name: quarkus-petclinic
          image: 'quay.io/dsanchor/quarkus-petclinic:in-mem'
          ports:
            - containerPort: 8080
              protocol: TCP
          resources: {}
          imagePullPolicy: Always</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s focus on each individual parts:</p>
</div>
<div class="paragraph">
<p>First part, there is basically the <code>kind</code> and <code>apiVersion</code> for a <code>Deployment</code> API object and then, we just add a name and a set of <code>labels</code> under <code>metadata</code>:</p>
</div>
<div class="paragraph">
<p><span class="image"><a class="image" href="../_images/01-introduction/d-name.png" target="_blank" rel="noopener"><img src="../_images/01-introduction/d-name.png" alt="deployment name"></a></span></p>
</div>
<div class="paragraph">
<p>Next, we have the <code>spec</code> part of the object. This is where we basically define the desired state of our <code>Deployment</code>.</p>
</div>
<div class="paragraph">
<p>Grouping some parts of it, we have:</p>
</div>
<div class="paragraph">
<p><span class="image"><a class="image" href="../_images/01-introduction/d-part1.png" target="_blank" rel="noopener"><img src="../_images/01-introduction/d-part1.png" alt="deployment part1"></a></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Number of desired pods managed by this <code>Deployment</code> and its <code>ReplicaSet</code></p>
</li>
<li>
<p>Selector, that will basically tell which pods are managed by the <code>ReplicaSet</code>.</p>
</li>
<li>
<p>Deployment strategy, which set how pods are created/destroy during update process.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>And finally the template definition, that describes how a pod will look like:</p>
</div>
<div class="paragraph">
<p><span class="image"><a class="image" href="../_images/01-introduction/d-part2.png" target="_blank" rel="noopener"><img src="../_images/01-introduction/d-part2.png" alt="deployment part2"></a></span></p>
</div>
<div class="paragraph">
<p>We will see more details about every part of the <code>pod</code> itself while going through the labs.</p>
</div>
<div class="sect2">
<h3 id="_create_our_first_deployment_in_your_project"><a class="anchor" href="#_create_our_first_deployment_in_your_project"></a>2.1. Create our first deployment in your project</h3>
<div class="paragraph">
<p>As said, we will apply the YAML descriptor into our project. To do so, execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ oc apply -f $LABS_HOME/lab1/app-deployment.yaml -n &lt;YOUR_PROJECT&gt;

deployment.apps/quarkus-petclinic created</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can move to one project to another with <code>oc project &lt;PROJECT&gt;</code> and there is no need to add the extra <code>-n &lt;PROJECT&gt;</code> to perform actions over the current <code>project</code>, although when having many <code>projects</code>, the <code>-n</code> option will give you the peace and serenity about being doing stuff where you really want to :-)
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s also have a look at what has been created already in our project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ oc get all -n &lt;YOUR_PROJECT&gt;

NAME                                     READY   STATUS    RESTARTS   AGE
pod/postgresql-767f6bfb8-gv8qg           1/1     Running   0          20m
pod/quarkus-petclinic-7c97ccbb85-gv8rd   1/1     Running   0          37s

NAME                 TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE
service/postgresql   ClusterIP   172.30.149.10   &lt;none&gt;        5432/TCP   20m

NAME                                READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/postgresql          1/1     1            1           20m
deployment.apps/quarkus-petclinic   1/1     1            1           38s

NAME                                           DESIRED   CURRENT   READY   AGE
replicaset.apps/postgresql-767f6bfb8           1         1         1       20m
replicaset.apps/quarkus-petclinic-7c97ccbb85   1         1         1       38s</pre>
</div>
</div>
<div class="paragraph">
<p>We have not only a <code>Deployment</code> but a <code>ReplicaSet</code> and a single <code>Pod</code>.</p>
</div>
<div class="paragraph">
<p>By creating a <code>Deployment</code>, a <code>ReplicaSet</code> has been created in order to ensure that the specified number of pods are running at a given moment in time.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s move to the console and see what we have. This time, we will use the <code>Developer</code> view. Select that perspective on the left top corner:</p>
</div>
<div class="paragraph">
<p><span class="image"><a class="image" href="../_images/01-introduction/just-deployment.png" target="_blank" rel="noopener"><img src="../_images/01-introduction/just-deployment.png" alt="just deployment"></a></span></p>
</div>
<div class="paragraph">
<p>If you click on the blue circle (2), you will get all details about the application (3).</p>
</div>
<div class="paragraph">
<p>As you can tell, there is not any <code>Service</code> nor <code>Route</code> created for it yet. That means, this application is just locally accesible if you would know the pod ip (unprobable.. and undesired).</p>
</div>
<div class="paragraph">
<p>Click on the <code>pod</code> link (4) and get a terminal screen within that <code>pod</code>:</p>
</div>
<div class="paragraph">
<p><span class="image"><a class="image" href="../_images/01-introduction/pod-terminal.png" target="_blank" rel="noopener"><img src="../_images/01-introduction/pod-terminal.png" alt="pod terminal"></a></span></p>
</div>
<div class="paragraph">
<p>To test the application locally, execute the following in the terminal:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ curl -v localhost:8080 | grep 200</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In case you did not get a <code>HTTP/1.1 200 OK</code> response, let us know.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_add_a_service_to_your_application"><a class="anchor" href="#_add_a_service_to_your_application"></a>2.2. Add a service to your application</h3>
<div class="paragraph">
<p>Once we tested the application, lets add a <code>Service</code> that will provide us a logical name to access to this application. It will also be used as a load balancer for the possible 'n' pods we may have later for this <code>Deployment</code>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ oc apply -f $LABS_HOME/lab1/app-service.yaml -n &lt;YOUR_PROJECT&gt;

service/quarkus-petclinic created</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you could have ran the next <code>oc</code> command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>oc expose deployment/quarkus-petclinic --port=8080 -n &lt;YOUR_PROJECT&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Feel free to run again a <em>oc get all</em> to see that the service has been successfully created.</p>
</div>
<div class="paragraph">
<p>Also, if you move back to the console, you will notice that the service is "assigned" to the application:</p>
</div>
<div class="paragraph">
<p><span class="image"><a class="image" href="../_images/01-introduction/with-service.png" target="_blank" rel="noopener"><img src="../_images/01-introduction/with-service.png" alt="with service"></a></span></p>
</div>
<div class="paragraph">
<p>Test the application again from the <code>pod</code> terminal, but this time use the <code>service</code> name instead:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ curl -v quarkus-petclinic:8080 | grep 200</pre>
</div>
</div>
<div class="paragraph">
<p>Hope you got a <code>HTTP/1.1 200 OK</code>! If that is the case, let&#8217;s make our application externally acessible by adding a <code>route</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_create_a_route"><a class="anchor" href="#_create_a_route"></a>2.3. Create a route</h3>
<div class="paragraph">
<p>Apply the following YAML in your project:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ oc apply -f $LABS_HOME/lab1/app-route.yaml -n &lt;YOUR_PROJECT&gt;

route.route.openshift.io/quarkus-petclinic created</pre>
</div>
</div>
<div class="paragraph">
<p>As previously mentioned for <code>services</code>, you could use the <code>oc expose</code> command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>oc expose svc/quarkus-petclinic -n &lt;YOUR_PROJECT&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>It is then time to access to our application using a web browser. To do so, let&#8217;s first get the <code>host</code> where this application is exposed:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ oc get route -n &lt;YOUR_PROJECT&gt;

NAME                HOST/PORT                                                  PATH   SERVICES            PORT       TERMINATION   WILDCARD
quarkus-petclinic   quarkus-petclinic-user0.apps.labs.sandbox779.opentlc.com          quarkus-petclinic   8080-tcp                 None</pre>
</div>
</div>
<div class="paragraph">
<p>Copy the value under <code>HOST/PORT</code> column in your preferred web browser. And then&#8230;&#8203; there we go!</p>
</div>
<div class="paragraph">
<p><span class="image"><a class="image" href="../_images/01-introduction/petclinic-web.png" target="_blank" rel="noopener"><img src="../_images/01-introduction/petclinic-web.png" alt="petclinic"></a></span></p>
</div>
<div class="paragraph">
<p>Congratulations! You have successfully deployed your first application.</p>
</div>
<div class="paragraph">
<p>Just a few  considerations about the application. This application requires access to a DB in order to persist any change. In this lab, we used an in-memory H2 DB within our application.. so in case you add/remove pets, this changes are only persisted to that single pod.</p>
</div>
<div class="paragraph">
<p>You would also notice that in case you kill/delete the pod, those pets previously created would have been lost.</p>
</div>
<div class="paragraph">
<p>Feel free to perform these very usefull exercises to understand that <em>pods are ephemeral</em>.</p>
</div>
<div class="paragraph">
<p>But no worries, <strong>our pets deserve the best</strong>.. so will deploy a proper DB in the next lab and link the application pods to it.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_scale_the_application_pod_replicas"><a class="anchor" href="#_scale_the_application_pod_replicas"></a>3. Scale the application pod replicas</h2>
<div class="sectionbody">
<div class="paragraph">
<p>So far, we have just a single replica of our "Pet clinic" web site&#8230;&#8203; That is not high available and fault tolerant at all.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s scale it up to 3 replicas by running the next command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>oc scale deployment/quarkus-petclinic --replicas=3 -n &lt;YOUR_PROJECT&gt;

deployment.apps/quarkus-petclinic scaled</pre>
</div>
</div>
<div class="paragraph">
<p>You could now continue adding data from the web application, it does not matter from which <code>pod</code> you are accesing to the Database, the same data is accessible from all the application pods.</p>
</div>
<div class="paragraph">
<p>Feel free to scale it down and up again and check that the application works as expected and does not miss any data.</p>
</div>
<div class="sect2">
<h3 id="_extra_rolling_vs_recreate_deployment_strategy"><a class="anchor" href="#_extra_rolling_vs_recreate_deployment_strategy"></a>3.1. Extra: Rolling vs Recreate deployment strategy</h3>
<div class="paragraph">
<p>Have a look at the following resources and then, answer a couple of questions that are related to this topic based on our scenario:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.openshift.com/container-platform/4.6/applications/deployments/deployment-strategies.html#deployments-rolling-strategy_deployment-strategies">Rolling</a></p>
</li>
<li>
<p><a href="https://docs.openshift.com/container-platform/4.6/applications/deployments/deployment-strategies.html#deployments-recreate-strategy_deployment-strategies">Recreate</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So.. could you have a look at what strategies are used in both the application and the Database?</p>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../../_/js/vendor/clipboard.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
