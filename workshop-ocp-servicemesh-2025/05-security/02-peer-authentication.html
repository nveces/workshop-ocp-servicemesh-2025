<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Lab 2 - PeerAuthentication :: WorkShop - Service Mesh on OCP 2025</title>
    <link rel="canonical" href="https://nveces.github.io/workshop-ocp-servicemesh-2025/workshop-ocp-servicemesh-2025/05-security/02-peer-authentication.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../../_/css/site.css">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="../../_/img/RHDLogo.svg" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://nveces.github.io/workshop-ocp-servicemesh-2025">WorkShop - Service Mesh on OCP 2025</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kafka-tutorial/" target="_blank">Kafka</a>
            <a class="navbar-item" href="https://devsecops-workshop.github.io/" target="_blank">DevSecOps</a>
            <a class="navbar-item" href="https://acidonper.github.io/redhat-workshop-cicd-gitops/redhat-workshop-cicd-gitops/" target="_blank">CI/CD & GitOps</a>
            <a class="navbar-item" href="https://atarazana.github.io/gramola-gitops-guide/gramola-gitops-guide/" target="_blank">Gramola GitOps Guide</a>
            <a class="navbar-item" href="https://luisarizmendi.github.io/tutorial-secure-onboarding/" target="_blank">Secure Edge device onboarding with RHEL and FDO</a>
            <a class="navbar-item" href="https://xbryan1.github.io/rhte-2023-acm-docs/" target="_blank">Multicluster Application Deployment with Advanced Cluster Management and GitOps</a>
            <a class="navbar-item" href="https://redhat-scholars.github.io/java-inner-loop-dev-guide/java-inner-loop-dev-guide/index.html" target="_blank">Java Inner Loop Dev Guide</a>
            <a class="navbar-item" href="https://atarazana.github.io/kitchensink-guide/" target="_blank">Deploying JBoss EAP applications on OpenShift</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="workshop-ocp-servicemesh-2025" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../01-setup.html">1. Environment Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../01-setup.html#prerequisite">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../01-setup.html#minikube">Setup Minikube</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../01-introduction/index.html">2. Introduction - Labs</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../01-introduction/index.html#_lab_0_warming_up">Lab 0 - Warming up</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../01-introduction/index.html#_lab_1_first_application_deployment">Lab 1 - First application deployment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../01-introduction/index.html#_lab_2_complete_application_deployment">Lab 2 - Complete application deployment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../01-introduction/index.html#_lab_3_adding_persistent_volumes">Lab 3 - Adding persistent volumes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../01-introduction/index.html#_lab_4_configuration_management">Lab 4 - Configuration management</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../01-introduction/index.html#_lab_5_resources">Lab 5 - Resources</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../01-introduction/index.html#_lab_6_liveness_and_readiness_probes">Lab 6 - Liveness and readiness probes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../02-envoy-istio-control-plane/index.html">3. Envoy istio Control plane - Labs</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../02-envoy-istio-control-plane/index.html#_lab_1_setup">Lab 1 - Setup</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../02-envoy-istio-control-plane/index.html#_lab_2_deploy_jump_app">Lab 2 - Deploy Jump App</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../02-envoy-istio-control-plane/index.html#_lab_3_service_mesh_communication_flows">Lab 3 - Service Mesh Communication Flows</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../02-envoy-istio-control-plane/index.html#_lab_4_istio_envoy_objects_relationship">Lab 4 - Istio-Envoy Objects Relationship</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../02-envoy-istio-control-plane/index.html#_lab_5_envoy_proxy">Lab 5 - Envoy Proxy</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../02-envoy-istio-control-plane/index.html#_lab_6_istio_control_plane">Lab 6 - Istio Control Plane</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../02-envoy-istio-control-plane/index.html#_lab_7_istio_global_services">Lab 7 - Istio Global Services</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../03-traffic-management/index.html">4. Traffic management - Labs</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../03-traffic-management/index.html#_rhossm_traffic_management_labs">{rhossm}: Traffic Management Labs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../03-traffic-management/index.html#_lab_1_ingress_gateways">Lab 1 - Ingress Gateways</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../03-traffic-management/index.html#_lab_2_requests_routing">Lab 2 - Requests Routing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../03-traffic-management/index.html#_lab_3_traffic_shifting_and_weight_balancing">Lab 3 - Traffic Shifting and Weight Balancing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../03-traffic-management/index.html#_lab_4_fault_injection">Lab 4 - Fault Injection</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../03-traffic-management/index.html#_lab_5_requests_timeouts">Lab 5 - Requests Timeouts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../03-traffic-management/index.html#_lab_6_circuit_breaking">Lab 6 - Circuit Breaking</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../03-traffic-management/index.html#_lab_7_mirroring_and_dark_launches">Lab 7 - Mirroring and Dark Launches</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../03-traffic-management/index.html#_lab_0_warming_up">Lab 0 - Warming up</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../04-troubleshooting/index.html">5. Troubleshooting - Labs</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../04-troubleshooting/index.html#_lab_1_setup">Lab 1 - Setup</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../04-troubleshooting/index.html#_lab_2_deploy_jump_app">Lab 2 - Deploy Jump App</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../04-troubleshooting/index.html#_lab_3_service_mesh_communication_flows">Lab 3 - Service Mesh Communication Flows</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../04-troubleshooting/index.html#_lab_4_service_mesh_ingress_traffic_flow">Lab 4 - Service Mesh Ingress Traffic Flow</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../04-troubleshooting/index.html#_lab_5_service_mesh_secure_ingress_traffic_flow">Lab 5 - Service Mesh Secure Ingress Traffic Flow</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../04-troubleshooting/index.html#_lab_6_service_mesh_secure_egress_traffic_flow">Lab 6 - Service Mesh Secure Egress Traffic Flow</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../04-troubleshooting/index.html#_lab_7_troubleshooting_tools">Lab 7 - Troubleshooting Tools</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">6. Security - Labs</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_lab_0_warming_up">Lab 0 - Warming up</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_lab_1_setup_demo_applications">Lab 1 - Setup demo applications</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_lab_2_peerauthentication">Lab 2 - PeerAuthentication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_lab_3_authorization_part_1">Lab 3 - Authorization: part 1</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_lab_4_requestauthentication">Lab 4 - RequestAuthentication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_lab_5_authorization_part_2">Lab 5 - Authorization: part 2</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../06-extensibility/index.html">7. Extensibility - Labs</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../06-extensibility/index.html#_rhossm_extensibility_labs">{rhossm}: Extensibility Labs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../06-extensibility/index.html#_lab_1_envoy_filters">Lab 1 - Envoy Filters</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../06-extensibility/index.html#_lab_2_waes">Lab 2 - {waes}</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">WorkShop - Service Mesh on OCP 2025</a></li>
    <li><a href="02-peer-authentication.html">Lab 2 - PeerAuthentication</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/nveces/workshop-ocp-servicemesh-2025/edit/master/documentation/modules/ROOT/pages/05-security/02-peer-authentication.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Lab 2 - PeerAuthentication</h1>
<div id="toc" class="toc">
<div id="toctitle">PeerAuthentication</div>
<ul class="sectlevel1">
<li><a href="#_enforce_mtls_in_our_namespace_apps_ns1">1. Enforce mTLS in our namespace $APPS_NS1</a></li>
<li><a href="#_configure_mtls_in_our_services_under_apps_ns1">2. Configure mTLS in our services under $APPS_NS1</a></li>
<li><a href="#_enforce_mtls_and_configure_services_in_apps_ns2">3. Enforce mTLS and configure services in $APPS_NS2</a></li>
<li><a href="#_optional_add_namespace_wide_destinationrule_for_mtls">4. Optional: add namespace-wide DestinationRule for mTLS</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In this lab, we are going to configure mTLS for all comunications between our existing services.</p>
</div>
<div class="paragraph">
<p>One of the possibilities would be to <code>auto enable</code> mTLS globally in the <code>mesh</code> during the <code>ServiceMeshControlPlane</code> installation process.</p>
</div>
<div class="paragraph">
<p>In our case, we chose not to do it that way, so we can reach this lab and enable mTLS in each service to service communication as an exercise to practice with this kind of scenarios.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This lab about mTLS is very similar to the one we did in <strong>Service Mesh - Introduction</strong>, but it is required to move to next labs and also, good to remember what we did and how we did it.  This time, we will apply the configuration in a few steps only.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_enforce_mtls_in_our_namespace_apps_ns1"><a class="anchor" href="#_enforce_mtls_in_our_namespace_apps_ns1"></a>1. Enforce mTLS in our namespace $APPS_NS1</h2>
<div class="sectionbody">
<div class="paragraph">
<p>First, we are going to enforce that any service to service communication in our <code>namespace</code> is covered by mTLS.</p>
</div>
<div class="paragraph">
<p>To do so, we will create a <a href="https://istio.io/v1.6/docs/reference/config/security/peer_authentication/">PeerAuthentication</a> object that set the mTLS mode to <code>strict</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ oc apply -f $LABS_HOME/lab2/peer-authentication-strict.yaml -n $APPS_NS1

peerauthentication.security.istio.io/peer-auth-policy created</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
When setting PeerAuthentication to STRICT namespace wide, we will get an error in <code>Kiali</code> telling that "Destination Rule enabling namespace-wide mTLS is missing". In our case, we don&#8217;t really care, as in this lab, we will enable mTLS service by service in the namespace.
<span class="image"><a class="image" href="../_images/05-security/error-paut.png" target="_blank" rel="noopener"><img src="../_images/05-security/error-paut.png" alt="Error PeerAthentication"></a></span>
<strong>Ignore it for the rest of the lab.</strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Test your application again. It does not work anymore. You should get an error like this one:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>upstream connect error or disconnect/reset before headers. reset reason: connection termination</pre>
</div>
</div>
<div class="paragraph">
<p>And that is because we are enforcing mTLS and our services have not been configured to support it yet.</p>
</div>
<div class="paragraph">
<p>To do so, we will take advantage of an interesting <code>Istio</code> feature wich is the <code>ISTIO_MUTUAL</code> traffic policy: we let the proxy serves an <code>Istio</code> managed certificate associated per <code>ServiceAccount</code> to have mTLS without any change in our application.</p>
</div>
<div class="paragraph">
<p>This <code>ServiceAccount</code> per service will let us identify the caller independently as each <code>ServiceAccount</code> will have a certificate associated to it. We will debug a bit to understand what happens under the covers.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configure_mtls_in_our_services_under_apps_ns1"><a class="anchor" href="#_configure_mtls_in_our_services_under_apps_ns1"></a>2. Configure mTLS in our services under $APPS_NS1</h2>
<div class="sectionbody">
<div class="paragraph">
<p>What will do next is to start setting <code>ISTIO_MUTUAL</code> in our services. We will achieve it by adding a <code>trafficPolicy</code> section of the <code>DestinationRule</code> where will describe the <code>tls mode</code>. In this case, it will be set to <code>ISTIO_MUTUAL</code>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s first understand the changes that we are going to apply in every <code>DestinationRule</code>. For that, we will get one before applying any change:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$  oc get destinationrule/productpage -o yaml -n $APPS_NS1
...
 (let's focus on the spec part of it)
...
 spec:
  host: productpage
  subsets:
  - labels:
      version: v1
    name: v1</pre>
</div>
</div>
<div class="paragraph">
<p>Apply the changes:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ oc patch destinationrule/productpage --type=merge -p '{"spec":{"trafficPolicy":{"tls":{"mode":"ISTIO_MUTUAL"}}}}' -n $APPS_NS1

destinationrule.networking.istio.io/productpage patched</pre>
</div>
</div>
<div class="paragraph">
<p>And get again the same <code>DestinatioRule</code> to see the <code>trafficPolicy</code> section that has been added:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$  oc get destinationrule/productpage -o yaml -n $APPS_NS1
...
 (let's focus on the spec part of it)
...
spec:
  host: productpage
  subsets:
  - labels:
      version: v1
    name: v1
  trafficPolicy:
    tls:
      mode: ISTIO_MUTUAL</pre>
</div>
</div>
<div class="paragraph">
<p>We do the same for every service. Patch the one for <code>details</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ oc patch destinationrule/details --type=merge -p '{"spec":{"trafficPolicy":{"tls":{"mode":"ISTIO_MUTUAL"}}}}' -n $APPS_NS1

destinationrule.networking.istio.io/details patched</pre>
</div>
</div>
<div class="paragraph">
<p>Then <code>reviews</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ oc patch destinationrule/reviews --type=merge -p '{"spec":{"trafficPolicy":{"tls":{"mode":"ISTIO_MUTUAL"}}}}' -n $APPS_NS1

destinationrule.networking.istio.io/reviews patched</pre>
</div>
</div>
<div class="paragraph">
<p>And last from $APPS_NS1 is <code>ratings</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ oc patch destinationrule/ratings --type=merge -p '{"spec":{"trafficPolicy":{"tls":{"mode":"ISTIO_MUTUAL"}}}}' -n $APPS_NS1

destinationrule.networking.istio.io/ratings patched</pre>
</div>
</div>
<div class="paragraph">
<p>Test the application again and check that is working fine. You can also leave some tests running (don&#8217;t forget to change to your domain:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>watch -n1 curl -k https://${PRODUCTPAGE_HOST}/productpage</pre>
</div>
</div>
<div class="paragraph">
<p>Finally, move to <code>Kiali</code> and select the <code>Security</code> check box in the graph <code>Display options</code>. We should get a lock icon between each service call:</p>
</div>
<div class="paragraph">
<p><span class="image unresolved"><a class="image" href="../_images/05-security/security-check.gif" target="_blank" rel="noopener"><img src="05-security/security-check.gif" alt="Mtls in ns1"></a></span></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_enforce_mtls_and_configure_services_in_apps_ns2"><a class="anchor" href="#_enforce_mtls_and_configure_services_in_apps_ns2"></a>3. Enforce mTLS and configure services in $APPS_NS2</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We will apply the same changes in $APPS_NS2:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a <code>PeerAuthentication</code> with STRICT mode</p>
</li>
</ul>
</div>
<div class="literalblock">
<div class="content">
<pre>$ oc apply -f $LABS_HOME/lab2/peer-authentication-strict.yaml -n $APPS_NS2

peerauthentication.security.istio.io/peer-auth-policy created</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Set <code>ISTIO_MUTUAL</code> in every service.</p>
</li>
</ul>
</div>
<div class="literalblock">
<div class="content">
<pre>$ oc patch destinationrule/reviews --type=merge -p '{"spec":{"trafficPolicy":{"tls":{"mode":"ISTIO_MUTUAL"}}}}' -n $APPS_NS2

destinationrule.networking.istio.io/reviews patched</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>$ oc patch destinationrule/ratings --type=merge -p '{"spec":{"trafficPolicy":{"tls":{"mode":"ISTIO_MUTUAL"}}}}' -n $APPS_NS2

destinationrule.networking.istio.io/ratings patched</pre>
</div>
</div>
<div class="paragraph">
<p>We have now finished setting mTLS between all our services calls. We can move now to the first part of the <code>authorization</code> labs.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_optional_add_namespace_wide_destinationrule_for_mtls"><a class="anchor" href="#_optional_add_namespace_wide_destinationrule_for_mtls"></a>4. Optional: add namespace-wide DestinationRule for mTLS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In case you want to get rid of the <code>PeerAuthentication</code> <strong>validation error</strong>, you could create a <code>DestinationRule</code> that would cover all your services in the <code>namespace</code> with mTLS (As you could have checked already, all our services are fully working and have mTLS. We have set it individually instead, but if the validation error really annoys you, feel free to remove it).</p>
</div>
<div class="paragraph">
<p>This is the  YAML file you could use as template, replace $APPS_NS with your <code>namespace</code> before applying (you must do it with both $APPS_NS1 and $APPS_NS2):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>apiVersion: networking.istio.io/v1alpha3
kind: DestinationRule
metadata:
  name: enable-mtls-ns-wide
  namespace: ${APPS_NS}
spec:
  host: "*.${APPS_NS}.svc.cluster.local"
  trafficPolicy:
    tls:
      mode: ISTIO_MUTUAL</pre>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../../_/js/vendor/clipboard.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
