<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Lab 4 - Service Mesh Ingress Traffic Flow :: WorkShop - Service Mesh on OCP 2025</title>
    <link rel="canonical" href="https://nveces.github.io/workshop-ocp-servicemesh-2025/workshop-ocp-servicemesh-2025/04-troubleshooting/04-ingress-traffic.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../../_/css/site.css">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img
          src="../../_/img/header_logo.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" href="https://nveces.github.io/workshop-ocp-servicemesh-2025">WorkShop - Service Mesh on OCP 2025</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Books</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">CheatSheets</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">CheatSheet A</a>
            <a class="navbar-item" href="#">CheatSheet B</a>
            <a class="navbar-item" href="#">CheatSheet C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Upcoming Events</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Event A</a>
            <a class="navbar-item" href="#">Event B</a>
            <a class="navbar-item" href="#">Event C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Tutorial A</a>
            <a class="navbar-item" href="#">Tutorial B</a>
            <a class="navbar-item" href="#">Tutorial C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="workshop-ocp-servicemesh-2025" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">WorkShop - Service Mesh on OCP 2025</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../01-setup.html">1. Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../01-setup.html#prerequisite">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../01-setup.html#minikube">Setup Minikube</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../02-deploy.html">2. Deploy Service</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../02-deploy.html#package">Build Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../02-deploy.html#deploy">Deploy Dervice</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../01-introduction/index.html">3. Introduction - Labs</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../01-introduction/index.html#_lab_0_warming_up">Lab 0 - Warming up</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../01-introduction/index.html#_lab_1_first_application_deployment">Lab 1 - First application deployment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../01-introduction/index.html#_lab_2_complete_application_deployment">Lab 2 - Complete application deployment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../01-introduction/index.html#_lab_3_adding_persistent_volumes">Lab 3 - Adding persistent volumes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../01-introduction/index.html#_lab_4_configuration_management">Lab 4 - Configuration management</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../01-introduction/index.html#_lab_5_resources">Lab 5 - Resources</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../01-introduction/index.html#_lab_6_liveness_and_readiness_probes">Lab 6 - Liveness and readiness probes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../02-envoy-istio-control-plane/index.html">4. Envoy istio Control plane - Labs</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../02-envoy-istio-control-plane/index.html#_lab_1_setup">Lab 1 - Setup</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../02-envoy-istio-control-plane/index.html#_lab_2_deploy_jump_app">Lab 2 - Deploy Jump App</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../02-envoy-istio-control-plane/index.html#_lab_3_service_mesh_communication_flows">Lab 3 - Service Mesh Communication Flows</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../02-envoy-istio-control-plane/index.html#_lab_4_istio_envoy_objects_relationship">Lab 4 - Istio-Envoy Objects Relationship</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../02-envoy-istio-control-plane/index.html#_lab_5_envoy_proxy">Lab 5 - Envoy Proxy</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../02-envoy-istio-control-plane/index.html#_lab_6_istio_control_plane">Lab 6 - Istio Control Plane</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../02-envoy-istio-control-plane/index.html#_lab_7_istio_global_services">Lab 7 - Istio Global Services</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../03-traffic-management/index.html">5. Traffic management - Labs</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../03-traffic-management/index.html#_rhossm_traffic_management_labs">{rhossm}: Traffic Management Labs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../03-traffic-management/index.html#_lab_1_ingress_gateways">Lab 1 - Ingress Gateways</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../03-traffic-management/index.html#_lab_2_requests_routing">Lab 2 - Requests Routing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../03-traffic-management/index.html#_lab_3_traffic_shifting_and_weight_balancing">Lab 3 - Traffic Shifting and Weight Balancing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../03-traffic-management/index.html#_lab_4_fault_injection">Lab 4 - Fault Injection</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../03-traffic-management/index.html#_lab_5_requests_timeouts">Lab 5 - Requests Timeouts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../03-traffic-management/index.html#_lab_6_circuit_breaking">Lab 6 - Circuit Breaking</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../03-traffic-management/index.html#_lab_7_mirroring_and_dark_launches">Lab 7 - Mirroring and Dark Launches</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../03-traffic-management/index.html#_lab_0_warming_up">Lab 0 - Warming up</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">6. Troubleshooting - Labs</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_lab_1_setup">Lab 1 - Setup</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_lab_2_deploy_jump_app">Lab 2 - Deploy Jump App</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_lab_3_service_mesh_communication_flows">Lab 3 - Service Mesh Communication Flows</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_lab_4_service_mesh_ingress_traffic_flow">Lab 4 - Service Mesh Ingress Traffic Flow</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_lab_5_service_mesh_secure_ingress_traffic_flow">Lab 5 - Service Mesh Secure Ingress Traffic Flow</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_lab_6_service_mesh_secure_egress_traffic_flow">Lab 6 - Service Mesh Secure Egress Traffic Flow</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_lab_7_troubleshooting_tools">Lab 7 - Troubleshooting Tools</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../05-security/index.html">7. Security - Labs</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../05-security/index.html#_lab_0_warming_up">Lab 0 - Warming up</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../05-security/index.html#_lab_1_setup_demo_applications">Lab 1 - Setup demo applications</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../05-security/index.html#_lab_2_peerauthentication">Lab 2 - PeerAuthentication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../05-security/index.html#_lab_3_authorization_part_1">Lab 3 - Authorization: part 1</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../05-security/index.html#_lab_4_requestauthentication">Lab 4 - RequestAuthentication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../05-security/index.html#_lab_5_authorization_part_2">Lab 5 - Authorization: part 2</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../06-extensibility/index.html">8. Extensibility - Labs</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../06-extensibility/index.html#_rhossm_extensibility_labs">{rhossm}: Extensibility Labs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../06-extensibility/index.html#_lab_1_envoy_filters">Lab 1 - Envoy Filters</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../06-extensibility/index.html#_lab_2_waes">Lab 2 - {waes}</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">WorkShop - Service Mesh on OCP 2025</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">WorkShop - Service Mesh on OCP 2025</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="../index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">WorkShop - Service Mesh on OCP 2025</a></li>
    <li><a href="04-ingress-traffic.html">Lab 4 - Service Mesh Ingress Traffic Flow</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/nveces/workshop-ocp-servicemesh-2025/edit/master/documentation/modules/ROOT/pages/04-troubleshooting/04-ingress-traffic.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Lab 4 - Service Mesh Ingress Traffic Flow</h1>
<div id="toc" class="toc">
<div id="toctitle">Service Mesh Ingress Traffic Flow</div>
<ul class="sectlevel1">
<li><a href="#04-ingress">1. Introduction</a></li>
<li><a href="#04-troubleshooting">2. Ingress Gateway Traffic Flow Troubleshooting</a></li>
<li><a href="#04-customize">3. Customize Jump App</a>
<ul class="sectlevel2">
<li><a href="#04-cust-state">3.1. Confirm <em>Jump App</em> state</a></li>
</ul>
</li>
<li><a href="#04-router">4. Openshift Router &#8594; Ingress Gateway Connectivity</a>
<ul class="sectlevel2">
<li><a href="#04-trou-con">4.1. Test connectivity via command line</a></li>
<li><a href="#04-trou-fix">4.2. Fix configuration problems</a></li>
<li><a href="#04-trou-con-again">4.3. Test connectivity again via command line</a></li>
</ul>
</li>
<li><a href="#04-gateway">5. Test Ingress Gateway &#8594; Sidecar Connectivity</a>
<ul class="sectlevel2">
<li><a href="#04-gateway-con">5.1. Test connectivity via command line</a></li>
<li><a href="#04-gateway-fix">5.2. Fix configuration problems</a></li>
<li><a href="#04-gateway-con-again">5.3. Test connectivity again via command line</a></li>
<li><a href="#04-gateway-fix2">5.4. Fix configuration problems</a></li>
<li><a href="#04-gateway-con-again2">5.5. Test connectivity again via command line</a></li>
</ul>
</li>
<li><a href="#04-sidecar">6. Test Sidecar &#8594; App Connectivity</a>
<ul class="sectlevel2">
<li><a href="#04-sidecar-test">6.1. Test connectivity via command line</a></li>
</ul>
</li>
<li><a href="#04-test">7. Confirm <em>Jump App</em> is running again</a></li>
<li><a href="#04-kiali">8. Visit Kiali</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="04-ingress"><a class="anchor" href="#04-ingress"></a>1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>During this section, you will customize <em>Jump App</em> and resolve any problems found during this customization process using the command line and Kiali as the main troubleshooting tools.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="04-troubleshooting"><a class="anchor" href="#04-troubleshooting"></a>2. Ingress Gateway Traffic Flow Troubleshooting</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As you might know, we have 3 important objects in Istio that are essential to redirect ingress traffic from the Ingress Gateway to the application pods in Service Mesh:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Gateways</p>
</li>
<li>
<p>Virtual Services</p>
</li>
<li>
<p>Destination Rules</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>During the following sections, you will work with these objects and test, step by step, each segment of ingress traffic route:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Openshift Router &#8594; Ingress Gateway</p>
</li>
<li>
<p>Ingress Gateway &#8594; Sidecar</p>
</li>
<li>
<p>Sidecar &#8594; App</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You will use <em>OC client</em>, <em>curl</em> and <em>Kiali</em> as the main troubleshooting tools
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="04-customize"><a class="anchor" href="#04-customize"></a>3. Customize Jump App</h2>
<div class="sectionbody">
<div class="paragraph">
<p>First of all, it is required to modify <em>Jump App</em> Service Mesh objects in order to emulate a real life day 2 operation.</p>
</div>
<div class="paragraph">
<p>Please, return to the git repository and apply some customizations through the respective Openshift template executing the following command:</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/04-troubleshooting/04-ingress-traffic.adoc - include::partials/04-troubleshooting/oc_process_apply.adoc[]</p>
</div>
<div class="paragraph">
<div class="title">Jump App Customizations Applied I</div>
<p><span class="image unresolved"><img src="jump-app-mod-gw-ok.png" alt="jump app mod gw ok"></span></p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/04-troubleshooting/04-ingress-traffic.adoc - include::partials/04-troubleshooting/oc_process_delete.adoc[]</p>
</div>
<div class="paragraph">
<div class="title">Jump App Customizations Applied II</div>
<p><span class="image unresolved"><img src="jump-app-mod-svc-ok.png" alt="jump app mod svc ok"></span></p>
</div>
<div class="sect2">
<h3 id="04-cust-state"><a class="anchor" href="#04-cust-state"></a>3.1. Confirm <em>Jump App</em> state</h3>
<div class="paragraph">
<p>Once <em>Jump App</em> customizations have been applied, it is time to review your demo application services state.</p>
</div>
<div class="paragraph">
<p>Please, execute the following steps in order to review your demo app current state after the customization:</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/04-troubleshooting/04-ingress-traffic.adoc - include::partials/04-troubleshooting/check_jumpapp_mesh_fail.adoc[]</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="04-router"><a class="anchor" href="#04-router"></a>4. Openshift Router &#8594; Ingress Gateway Connectivity</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image unresolved"><img src="jump-app-ingress-router-gw.png" alt="jump app ingress router gw"></span></p>
</div>
<div class="sect2">
<h3 id="04-trou-con"><a class="anchor" href="#04-trou-con"></a>4.1. Test connectivity via command line</h3>
<div class="paragraph">
<p>In order to verify the connectivity from the <em>OCP Routers</em> to the <em>Ingress Gateway</em>, it is required to follow the next steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Get pods in routes namespace</p>
</li>
</ul>
</div>
<div class="listingblock lines_7 console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-input hljs" data-lang="input">oc get pods -n openshift-ingress</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">OCP Router Pods</div>
<p><span class="image unresolved"><img src="ocp-routers-pods.png" alt="ocp routers pods"></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Connect to the router pod</p>
</li>
</ul>
</div>
<div class="listingblock lines_7 console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-input hljs" data-lang="input">oc project openshift-ingress
POD=$(oc get po -o jsonpath='{.items[0].metadata.name}' -n openshift-ingress)
oc rsh $POD</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Execute a HTTP request using curl command</p>
</li>
</ul>
</div>
<div class="listingblock lines_7 console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-input hljs" data-lang="input">curl -XGET -v --header "Host: back-golang-&lt;user_namespace&gt;.&lt;openshift_apps_domain&gt;" <a href="http://istio-ingressgateway.istio-system.svc.cluster.local:80" class="bare">http://istio-ingressgateway.istio-system.svc.cluster.local:80</a> -v</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">HTTP Response Error 404</div>
<p><span class="image unresolved"><img src="jump-app-trou-04-gw.png" alt="jump app trou 04 gw"></span></p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Note that the error is 404 because of the route, or path, is not found
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="04-trou-fix"><a class="anchor" href="#04-trou-fix"></a>4.2. Fix configuration problems</h3>
<div class="paragraph">
<p>After test the connectivity from the <em>OCP routers</em> to the <em>ingress gateway</em>, you should review the <em>Gateway</em> object configuration in order to verify its definition. Please, visit the Kiali console <strong>&lt;kiali_url&gt;</strong> and review the <em>Gateway</em> object current state:</p>
</div>
<div class="paragraph">
<div class="title">Kiali Console</div>
<p><span class="image unresolved"><img src="jump-app-kiali-trou-04.png" alt="jump app kiali trou 04"></span></p>
</div>
<div class="paragraph">
<div class="title">Kiali Console Gateway Error</div>
<p><span class="image unresolved"><img src="jump-app-kiali-trou-04-error.png" alt="jump app kiali trou 04 error"></span></p>
</div>
<div class="paragraph">
<p>If you take a look at the host paths closely, you can find a bad definition because of the pattern <strong>"-fail"</strong> included in the path. Please, modify this hostname and click on <strong>[ SAVE ]</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="04-trou-con-again"><a class="anchor" href="#04-trou-con-again"></a>4.3. Test connectivity again via command line</h3>
<div class="paragraph">
<p>Once <em>Gateway</em> object has been modified in Openshift, it is required to test your application again through the OCP router:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Get pods in routes namespace</p>
</li>
</ul>
</div>
<div class="listingblock lines_7 console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-input hljs" data-lang="input">oc get pods -n openshift-ingress</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">OCP Routers Pods</div>
<p><span class="image unresolved"><img src="ocp-routers-pods.png" alt="ocp routers pods"></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Connect to the router pod</p>
</li>
</ul>
</div>
<div class="listingblock lines_7 console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-input hljs" data-lang="input">oc project openshift-ingress
POD=$(oc get po -o jsonpath='{.items[0].metadata.name}' -n openshift-ingress)
oc rsh $POD</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Execute a HTTP request using curl command</p>
</li>
</ul>
</div>
<div class="listingblock lines_7 console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-input hljs" data-lang="input">curl -XGET -v --header "Host: back-golang-&lt;user_namespace&gt;.&lt;openshift_apps_domain&gt;" <a href="http://istio-ingressgateway.istio-system.svc.cluster.local:80" class="bare">http://istio-ingressgateway.istio-system.svc.cluster.local:80</a> -v</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">HTTP Response 503</div>
<p><span class="image unresolved"><img src="jump-app-trou-04-gw-ok.png" alt="jump app trou 04 gw ok"></span></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
At this time, you obtain a 503 error because the service is unavailable but this host exists and it is reachable
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="04-gateway"><a class="anchor" href="#04-gateway"></a>5. Test Ingress Gateway &#8594; Sidecar Connectivity</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image unresolved"><img src="jump-app-ingress-gw-sidecar.png" alt="jump app ingress gw sidecar"></span></p>
</div>
<div class="sect2">
<h3 id="04-gateway-con"><a class="anchor" href="#04-gateway-con"></a>5.1. Test connectivity via command line</h3>
<div class="paragraph">
<p>In order to verify the connectivity from the <em>Ingress gateway</em> to the <em>Envoy Sidecar</em>, via back-golang <em>k8s service</em>, it is required to follow the next steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Get pods in <em>istio-system</em> namespace</p>
</li>
</ul>
</div>
<div class="listingblock lines_7 console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-input hljs" data-lang="input">oc get pods -n istio-system</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Istio ControlPlane Pods</div>
<p><span class="image unresolved"><img src="ocp-istio-controlplane-pods.png" alt="ocp istio controlplane pods"></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Connect to the <em>Ingress Gateway</em> pod</p>
</li>
</ul>
</div>
<div class="listingblock lines_7 console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-input hljs" data-lang="input">oc project istio-system
POD=$(oc get po -l app=istio-ingressgateway -o jsonpath='{.items[0].metadata.name}' -n istio-system)
oc rsh $POD</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Execute a HTTP request using curl command</p>
</li>
</ul>
</div>
<div class="listingblock lines_7 console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-input hljs" data-lang="input">curl -XGET -v --header "Host: back-golang-&lt;user_namespace&gt;.&lt;openshift_apps_domain&gt;" <a href="http://back-golang.&lt;user_namespace&gt;.svc.cluster.local:8442" class="bare">http://back-golang.&lt;user_namespace&gt;.svc.cluster.local:8442</a> -v</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">HTTP Response Error</div>
<p><span class="image unresolved"><img src="jump-app-trou-04-svc.png" alt="jump app trou 04 svc"></span></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
At this time, you obtain <em>"Could not resolve host: back-golang.user1-namespace.svc.cluster.local"</em> because <em>back-golang.svc.cluster.local</em> k8s service is not found
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="04-gateway-fix"><a class="anchor" href="#04-gateway-fix"></a>5.2. Fix configuration problems</h3>
<div class="paragraph">
<p>After test the connectivity from the from the <em>Ingress Gateway</em> to the <em>Envoy Sidecar</em>, via back-golang <em>k8s service</em>, you should create the <em>back-golang</em> k8s service again in order to allow this connections.</p>
</div>
<div class="listingblock lines_7 console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-input hljs" data-lang="input">oc project $USER_NAMESPACE</code></pre>
</div>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/04-troubleshooting/04-ingress-traffic.adoc - include::partials/04-troubleshooting/oc_process_apply.adoc[]</p>
</div>
<div class="paragraph">
<div class="title">back-golang k8s Service Created</div>
<p><span class="image unresolved"><img src="jump-app-trou-04-svc-created.png" alt="jump app trou 04 svc created"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="04-gateway-con-again"><a class="anchor" href="#04-gateway-con-again"></a>5.3. Test connectivity again via command line</h3>
<div class="paragraph">
<p>Once the k8s service has been created again in Openshift, it is required to test your application again through the <em>Ingress Gateway</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Get pods in <em>istio-system</em> namespace</p>
</li>
</ul>
</div>
<div class="listingblock lines_7 console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-input hljs" data-lang="input">oc get pods -n istio-system</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Istio ControlPlane Pods</div>
<p><span class="image unresolved"><img src="ocp-istio-controlplane-pods.png" alt="ocp istio controlplane pods"></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Connect to the <em>ingress gateway</em> pod</p>
</li>
</ul>
</div>
<div class="listingblock lines_7 console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-input hljs" data-lang="input">oc project istio-system
POD=$(oc get po -l app=istio-ingressgateway -o jsonpath='{.items[0].metadata.name}' -n istio-system)
oc rsh $POD</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Execute a HTTP request using curl command</p>
</li>
</ul>
</div>
<div class="listingblock lines_7 console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-input hljs" data-lang="input">curl -XGET -v --header "Host: back-golang-&lt;user_namespace&gt;.&lt;openshift_apps_domain&gt;" <a href="http://istio-ingressgateway.istio-system.svc.cluster.local:80" class="bare">http://istio-ingressgateway.istio-system.svc.cluster.local:80</a> -v</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="image unresolved"><img src="jump-app-unavailable-back.png" alt="jump app unavailable back"></span></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
At this time, you obtain a 200 in this command but <em>external access</em> has an error because the service is unavailable but the k8s service is OK
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="04-gateway-fix2"><a class="anchor" href="#04-gateway-fix2"></a>5.4. Fix configuration problems</h3>
<div class="paragraph">
<p>After test the connectivity from the from the <em>Ingress Gateway</em> to the <em>Envoy Sidecar</em>, via <em>k8s service</em>, you should review the <em>Virtual Service</em> and <em>Destination Rule</em> objects configuration in order to verify their definition. Please, visit the Kiali console <strong>&lt;kiali_url&gt;</strong> and review the objects general state:</p>
</div>
<div class="paragraph">
<div class="title">Kiali Console</div>
<p><span class="image unresolved"><img src="jump-app-kiali-trou-04-vs-dr.png" alt="jump app kiali trou 04 vs dr"></span></p>
</div>
<div class="paragraph">
<div class="title">Kiali Console Virtual Service Error</div>
<p><span class="image unresolved"><img src="jump-app-kiali-trou-04-error-vs.png" alt="jump app kiali trou 04 error vs"></span></p>
</div>
<div class="paragraph">
<p>If you take a look at the host paths closely you can find a bad definition because of the pattern <strong>"-fail"</strong> included in the path. Please, modify this hostname and click on <strong>[ SAVE ]</strong>.</p>
</div>
<div class="paragraph">
<div class="title">Kiali Console Destination Rule Error</div>
<p><span class="image unresolved"><img src="jump-app-kiali-trou-04-error-dr.png" alt="jump app kiali trou 04 error dr"></span></p>
</div>
<div class="paragraph">
<p>Lastly, if you take a look at the label version you can find a bad definition. Please, replace <strong>fail</strong> with <strong>v1</strong> version and click on <strong>[ SAVE ]</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="04-gateway-con-again2"><a class="anchor" href="#04-gateway-con-again2"></a>5.5. Test connectivity again via command line</h3>
<div class="paragraph">
<p>Once these objects have been modified in Kiali, it is required to test your application again through the Ingress Gateway:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Get pods in <em>istio-system</em> namespace</p>
</li>
</ul>
</div>
<div class="listingblock lines_7 console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-input hljs" data-lang="input">oc get pods -n istio-system</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Istio ControlPlane Pods</div>
<p><span class="image unresolved"><img src="ocp-istio-controlplane-pods.png" alt="ocp istio controlplane pods"></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Connect to the <em>Ingress Gateway</em> pod</p>
</li>
</ul>
</div>
<div class="listingblock lines_7 console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-input hljs" data-lang="input">oc project istio-system
PPOD=$(oc get po -l app=istio-ingressgateway -o jsonpath='{.items[0].metadata.name}' -n istio-system)
oc rsh $POD</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Execute a HTTP request using curl command</p>
</li>
</ul>
</div>
<div class="listingblock lines_7 console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-input hljs" data-lang="input">curl -XGET -v --header "Host: back-golang-&lt;user_namespace&gt;.&lt;openshift_apps_domain&gt;" <a href="http://istio-ingressgateway.istio-system.svc.cluster.local:80" class="bare">http://istio-ingressgateway.istio-system.svc.cluster.local:80</a> -v</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">HTTP Response 200</div>
<p><span class="image unresolved"><img src="jump-app-trou-04-vsdr-ok.png" alt="jump app trou 04 vsdr ok"></span></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="04-sidecar"><a class="anchor" href="#04-sidecar"></a>6. Test Sidecar &#8594; App Connectivity</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image unresolved"><img src="jump-app-ingress-sidecar-app.png" alt="jump app ingress sidecar app"></span></p>
</div>
<div class="sect2">
<h3 id="04-sidecar-test"><a class="anchor" href="#04-sidecar-test"></a>6.1. Test connectivity via command line</h3>
<div class="paragraph">
<p>In order to verify the connectivity from the <em>Envoy Sidecar</em> to the <em>App</em> containers in the same pods, it is required to follow the next steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Get pods in your namespace</p>
</li>
</ul>
</div>
<div class="listingblock lines_7 console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-input hljs" data-lang="input">oc get pods -n $USER_NAMESPACE</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Jump App Pods</div>
<p><span class="image unresolved"><img src="jump_app_pods.png" alt="jump app pods"></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Connect to the <em>back-golang</em> pod</p>
</li>
</ul>
</div>
<div class="listingblock lines_7 console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-input hljs" data-lang="input">oc project $USER_NAMESPACE
oc exec -ti &lt;back-golang_pod_id&gt; -c istio-proxy -- sh</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Execute a HTTP request using curl command</p>
</li>
</ul>
</div>
<div class="listingblock lines_7 console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-input hljs" data-lang="input">curl -XGET -v --header "Host: back-golang-&lt;user_namespace&gt;.&lt;openshift_apps_domain&gt;" <a href="http://localhost:8442" class="bare">http://localhost:8442</a></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">HTTP Response 200</div>
<p><span class="image unresolved"><img src="jump-app-trou-04-sidecar-ok.png" alt="jump app trou 04 sidecar ok"></span></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="04-test"><a class="anchor" href="#04-test"></a>7. Confirm <em>Jump App</em> is running again</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once <em>Jump App</em> objects have been modified and fixed in Kiali and Openshift, it is required to follow the next steps in order to ensure your demo app is running properly:</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/ROOT/pages/04-troubleshooting/04-ingress-traffic.adoc - include::/04-troubleshooting/check_jumpapp_mesh.adoc[]</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="04-kiali"><a class="anchor" href="#04-kiali"></a>8. Visit Kiali</h2>
<div class="sectionbody">
<div class="paragraph">
<p>At this time, <em>Jump App</em> is generating traffic flow thanks to the frontend where it was given an specific number of continuous jumps. In order to review the Service Mesh traffic flow in your project, please visit the Kiali console <strong>&lt;kiali_url&gt;</strong>:</p>
</div>
<div class="paragraph">
<div class="title">Kiali Console</div>
<p><span class="image unresolved"><img src="jump-app-kiali.png" alt="jump app kiali"></span></p>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../../_/js/vendor/clipboard.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
